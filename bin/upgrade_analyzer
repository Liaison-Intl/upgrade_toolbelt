#!/usr/bin/env ruby

require_relative "../lib/upgrade_analyzer"

options = {}

OptionParser.new do |opts|
  opts.on("-b[BUILD_NUMBER]", "--build[=BUILD_NUMBER]", "The Travis build number to analyze. Ignored in listen mode.") do |build_number|
    options[:build] = build_number
  end
  opts.on("-l", "--listen", "Listen for builds to complete, analyzing PR's as their builds finish") do |repo|
    options[:listen] = repo
  end
  opts.on("-rREPOSITORY_NAME", "--repo=REPOSITORY_NAME", "GitHub repository to use. Include organization/user name and repo name") do |repo|
    options[:repo] = repo
  end
  opts.on("-t[GITHUB_TOKEN]", "--token[=GITHUB_TOKEN]", "Your personal GitHub token") do |github_token|
    options[:github_token] = github_token
  end
end.parse!

puts "\e[32m" + "options=#{(options).inspect}" + "\e[39m"
UpgradeAnalyzer::Listener.new(options).run
